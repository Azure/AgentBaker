[Unit]
Description=AKS Secure TLS Bootstrap Client
ConditionPathExists=/opt/bin/aks-secure-tls-bootstrap-client
Wants=network-online.target
After=network-online.target

[Service]
Type=oneshot
RemainAfterExit=yes

ExecStart=/opt/bin/aks-secure-tls-bootstrap-client \
    --verbose \
    --ensure-authorized \
    --next-proto=aks-tls-bootstrap \
    --kubeconfig=/var/lib/kubelet/kubeconfig \
    --cert-dir=/var/lib/kubelet/pki \
    --cluster-ca-file=/etc/kubernetes/certs/ca.crt \
    --log-file=/var/log/azure/aks/secure-tls-bootstrap.log \
    $BOOTSTRAP_FLAGS

[Install]
WantedBy=multi-user.target
