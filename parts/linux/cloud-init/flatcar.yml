variant: flatcar
version: 1.1.0
storage:
  files:
  - path: /etc/extensions/aks-sysext/usr/lib/extension-release.d/extension-release.aks-sysext
    mode: 0644
    contents:
      inline: |
        ID=flatcar
        SYSEXT_LEVEL=1.0

  - path: /etc/flatcar/update.conf
    overwrite: true
    mode: 0644
    contents:
      inline: |
        SERVER=disabled

  links:
  - path: /etc/extensions/aks-sysext/usr/local/bin
    target: /opt/bin
    hard: false

  directories:
  - path: /opt/bin
    mode: 0755
    user:
      name: root

  - path: /opt/cni/downloads
    mode: 0755
    user:
      name: root

  - path: /var/log/azure
    mode: 0755
    user:
      name: root

systemd:
  units:
  - name: containerd.service
    dropins:
    - name: 50-default-config.conf
      contents: |
        [Service]
        Environment=CONTAINERD_CONFIG=/etc/containerd/config.toml
