name: $(Date:yyyyMMdd)$(Rev:.r)_$(Build.SourceBranchName)_$(BuildID)
trigger: none
pr:
  branches:
    include:
    - master
    - dev
  paths:
    include:
    - schemas
    - vhdbuilder/packer
    - vhdbuilder/scripts/linux
    - .pipelines/.vsts-vhd-builder.yaml
    - .pipelines/templates/.builder-release-template.yaml
    - parts/linux/*
    - packer.mk
    exclude:
    - vhdbuilder/packer/*.ps1
    - vhdbuilder/packer/**/*.ps1
    - vhdbuilder/packer/*windows*
    - vhdbuilder/packer/**/*windows*
pool:
  name: $(POOL_NAME)
variables:
  - group: aks-vuln-to-kusto
  - group: "AKS Node SIG UA Token (KV)"
stages:
  - template: ./templates/.build-and-test-all-linux-vhds-template.yaml
    parameters:
      useOverrides: ${{ parameters.useOverrides }}
      overrideBranch: ${{ parameters.overrideBranch }}
      dryrun: ${{ parameters.dryrun }}
      vhddebug: ${{ parameters.vhddebug }}
      build1804containerd: false
      build1804gen2containerd: false
      build1804gpucontainerd: false
      build1804gen2gpucontainerd: true
      buildMarinerV2gen1: false
      buildAzureLinuxV2gen1: false
      buildAzureLinuxV3gen1: false
      buildMarinerV2gen2: true
      buildAzureLinuxV2gen2: false
      buildAzureLinuxV3gen2: false
      buildMarinerV2gen1fips: false
      buildAzureLinuxV2gen1fips: false
      buildAzureLinuxV3gen1fips: false
      buildMarinerV2gen2fips: false
      buildAzureLinuxV2gen2fips: false
      buildAzureLinuxV3gen2fips: false
      buildMarinerV2gen2kata: false
      buildAzureLinuxV2gen2kata: false
      buildMarinerV2ARM64: false
      buildAzureLinuxV2ARM64: false
      buildAzureLinuxV3ARM64: false
      buildMarinerV2gen2TrustedLaunch: false
      buildAzureLinuxV2gen2TrustedLaunch: false
      buildMarinerV2gen2kataTrustedLaunch: false
      buildAzureLinuxV2gen2kataTrustedLaunch: false
      build1804fipscontainerd: false
      build1804fipsgen2containerd: false
      build2004fipscontainerd: false
      build2004fipsgen2containerd: false
      build2204fipscontainerd: false
      build2204fipsgen2containerd: false
      build2204arm64gen2containerd: false
      build2404arm64gen2containerd: false
      build2204containerd: false
      build2204gen2containerd: true
      build2404containerd: false
      build2404gen2containerd: false
      build2004cvmgen2containerd: false
      build2204tlgen2containerd: false
      build2204minimalgen1containerd: false
      build2204minimalgen2containerd: false
